# P2P Debugger Environment Configuration

# Bootstrap peer address(es) (REQUIRED)
# Single bootstrap: BOOTSTRAP_PEERS=/ip4/159.203.190.22/tcp/9100/p2p/12D3KooWN4ovysY4dp45NhLPQ9ywEhK3Z1GmaCVhQKrKHrtk1R2x
# Multiple bootstraps (comma-separated): BOOTSTRAP_PEERS=/ip4/addr1/tcp/port1/p2p/peer1,/ip4/addr2/tcp/port2/p2p/peer2
BOOTSTRAP_PEERS=/ip4/159.203.190.22/tcp/9100/p2p/12D3KooWN4ovysY4dp45NhLPQ9ywEhK3Z1GmaCVhQKrKHrtk1R2x

# Your VPS public IP (REQUIRED for proper NAT traversal)
PUBLIC_IP=YOUR_VPS_PUBLIC_IP_HERE

# Listen port (default: 8001)
LISTEN_PORT=8002

# Rendezvous point for peer discovery
# Must match across all validators in the same network
# Devnet: powerloom-dsv-devnet-alpha
# Mainnet: powerloom-dsv-mainnet-alpha
RENDEZVOUS_POINT=powerloom-dsv-devnet-alpha

# Gossipsub topic prefix for snapshot submissions
# Topic will be constructed as: {GOSSIPSUB_SNAPSHOT_SUBMISSION_PREFIX}/all
# Devnet: /powerloom/dsv-devnet-alpha/snapshot-submissions
# Mainnet: /powerloom/dsv-mainnet-alpha/snapshot-submissions
GOSSIPSUB_SNAPSHOT_SUBMISSION_PREFIX=/powerloom/dsv-devnet-alpha/snapshot-submissions

# Operation mode: PUBLISHER, LISTENER, or DISCOVERY
# - PUBLISHER: Publishes test messages at regular intervals
# - LISTENER: Listens for messages and shows peers
# - DISCOVERY: Shows peers on discovery topic (epoch 0)
MODE=PUBLISHER

# Topic to use (optional - auto-constructed from GOSSIPSUB_SNAPSHOT_SUBMISSION_PREFIX if not specified)
# If TOPIC is set, it will be used directly
# If not set, topic will be: {GOSSIPSUB_SNAPSHOT_SUBMISSION_PREFIX}/all
# - For PUBLISHER/LISTENER: {prefix}/all
# - For DISCOVERY: {prefix}/0
TOPIC=

# Publisher settings
PUBLISH_MSG=automated-test-message
PUBLISH_INTERVAL=30  # seconds between publishes

# Listener settings
LIST_PEERS=true

# Logging
LOG_LEVEL=info

# ============================================
# VALIDATOR MESH MODE (for submission count updates)
# ============================================
# Enable validator mesh mode to listen to finalized batches and update submission counts
VALIDATOR_MESH_MODE=false

# Validator mesh topics (devnet defaults)
GOSSIPSUB_FINALIZED_BATCH_PREFIX=/powerloom/dsv-devnet-alpha/finalized-batches
GOSSIPSUB_VALIDATOR_PRESENCE_TOPIC=/powerloom/dsv-devnet-alpha/validator/presence

# Window timing (honor DSV aggregation windows)
LEVEL1_FINALIZATION_DELAY_SECONDS=10  # Wait for DSV internal Level 1 aggregation (default: 10s)
AGGREGATION_WINDOW_SECONDS=20         # Collect validator batches after Level 1 delay (default: 20s)

# Tally dumps
TALLY_DUMP_DIR=./tallies               # Directory for JSON tally files
ENABLE_TALLY_DUMPS=true                # Enable per-epoch dumps (default: true)
TALLY_RETENTION_FILES=1000             # Keep last N files (0 = unlimited, default: 1000)
TALLY_RETENTION_DAYS=7                 # Keep files from last N days (0 = unlimited, default: 7)
TALLY_PRUNE_INTERVAL_HOURS=1           # Prune interval in hours (default: 1)

# Contract updates (optional - disabled by default)
ENABLE_CONTRACT_UPDATES=false          # Enable/disable contract updates (default: false)
SUBMISSION_UPDATE_EPOCH_INTERVAL=10    # Update every N epochs (default: 10)

# Contract update method: "relayer" or "direct" (only if ENABLE_CONTRACT_UPDATES=true)
CONTRACT_UPDATE_METHOD=relayer

# Relayer configuration (if CONTRACT_UPDATE_METHOD=relayer)
RELAYER_URL=http://localhost:8080
RELAYER_AUTH_TOKEN=your_relayer_auth_token_here

# Direct contract configuration (if CONTRACT_UPDATE_METHOD=direct)
# Uses POWERLOOM_RPC_URL (same as event monitoring)
# Note: This is an EVM private key (secp256k1), NOT the libp2p PRIVATE_KEY (Ed25519)
EVM_PRIVATE_KEY=your_evm_private_key_hex_here

# Data market configuration (REQUIRED for validator mesh mode)
# Note: Level 2 batches don't contain dataMarket info, so we use a single configured value
DATA_MARKET_ADDRESS=0xYourDataMarketAddress

# Event monitoring (for EpochReleased events)
POWERLOOM_RPC_URL=https://your-powerloom-rpc-url-here
PROTOCOL_STATE_CONTRACT=0xYourProtocolStateContractAddress
EVENT_POLL_INTERVAL=12                 # Poll interval in seconds (default: 12)
EVENT_START_BLOCK=0                    # Start block for event monitoring (0 = latest)
EVENT_BLOCK_BATCH_SIZE=1000            # Block batch size for event queries (default: 1000)
